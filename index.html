<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Italian Conjugation Practice</title>
    <link
      rel="manifest"
      href="data:application/json;base64,eyJuYW1lIjoiSXRhbGlhbiBDb25qdWdhdGlvbiBQcmFjdGljZSIsInNob3J0X25hbWUiOiJJdGFsaWFuQ29uaiIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMmU3ZDMyIiwidGhlbWVfY29sb3IiOiIjMmU3ZDMyIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeE1qQWlJR2hsYVdkb2REMG9NVEF3SWo0OFkybHlZMnhsSUdONFBTSTJNQ0lnWTNrOUlqWXdJaUJ5UFNJek1DSWdabWxzYkQwaUl6SXpOekU0TXlJdlBqeDBaWGgwSUhnMlBTSTJNQ0lnZVRJOUlqUWlJSE4wZVd4bFBTSm1hV3hzT2lOdmJIZDBaVnRtYjI1MExYTnBlbVU2TVRBd2VIQmNJaUowWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsSWo1RFQwNGNUa1JjVkR3dmRHVjRkRDQ4TDNOMlp6ND0iLCJzaXplcyI6IjEyMHgxMjAiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0="
    />
    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1em;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #e9ecef;
      }

      .tab {
        background: none;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-size: 1em;
        color: #6c757d;
        transition: all 0.3s ease;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
        font-weight: 600;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .practice-section {
        text-align: center;
        margin-bottom: 30px;
      }

      .settings-panel {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid #dee2e6;
      }

      .settings-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }

      .settings-group {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        min-width: 250px;
      }

      .settings-group label {
        font-weight: 600;
        color: #495057;
        display: block;
        margin-bottom: 8px;
      }

      .level-range {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
      }

      .level-range select {
        padding: 8px 12px;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        font-size: 1em;
        background: white;
      }

      .tense-selection {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        text-align: left;
      }

      .tense-checkboxes {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }

      .tense-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tense-checkbox input[type="checkbox"] {
        width: 16px;
        height: 16px;
      }

      .tense-checkbox label {
        font-weight: normal;
        margin: 0;
        cursor: pointer;
      }

      .select-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        justify-content: center;
      }

      .btn-small {
        background: #6c757d;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-small:hover {
        background: #5a6268;
        transform: translateY(-1px);
      }

      .conjugation-display {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 30px;
        margin: 25px 0;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        border: 2px solid #dee2e6;
      }

      .verb-prompt {
        font-size: 1.8em;
        font-weight: 600;
        color: #495057;
        margin-bottom: 15px;
      }

      .conjugation-prompt {
        font-size: 1.3em;
        color: #6c757d;
        margin-bottom: 20px;
      }

      .answer-section {
        margin-top: 20px;
      }

      .answer-input {
        padding: 15px;
        font-size: 1.2em;
        border: 2px solid #dee2e6;
        border-radius: 10px;
        width: 100%;
        max-width: 300px;
        text-align: center;
        transition: border-color 0.3s ease;
      }

      .answer-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .answer-input.correct {
        border-color: #28a745;
        background-color: #d4edda;
      }

      .answer-input.incorrect {
        border-color: #dc3545;
        background-color: #f8d7da;
      }

      .controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 1em;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover {
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
      }

      .btn-success {
        background: #28a745;
      }

      .btn-success:hover {
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
      }

      .feedback-section {
        margin-top: 20px;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        display: none;
      }

      .feedback-section.success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        display: block;
      }

      .feedback-section.error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        display: block;
      }

      .feedback-section.info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
        display: block;
      }

      .empty-state {
        color: #6c757d;
        font-style: italic;
        font-size: 1.1em;
      }

      .stats-section {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        text-align: center;
      }

      .stat-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #dee2e6;
      }

      .stat-number {
        font-size: 1.5em;
        font-weight: 600;
        color: #495057;
      }

      .stat-label {
        font-size: 0.9em;
        color: #6c757d;
        margin-top: 5px;
      }

      .speaker-icon,
      .dict-icon {
        cursor: pointer;
        margin: 0 8px;
        font-size: 1.2em;
        opacity: 0.8;
        transition: all 0.2s;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
        padding: 4px 6px;
      }

      .speaker-icon:hover,
      .dict-icon:hover {
        transform: scale(1.2);
        opacity: 1;
        background: rgba(255, 255, 255, 0.3);
      }

      .info-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        line-height: 1.6;
      }

      .info-section h3 {
        color: #495057;
        margin-bottom: 20px;
        text-align: center;
      }

      .info-section h4 {
        color: #495057;
        margin-top: 20px;
        margin-bottom: 10px;
      }

      .info-section ul {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .info-section li {
        margin-bottom: 5px;
      }

      @media (max-width: 600px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2em;
        }

        .settings-row {
          flex-direction: column;
        }

        .controls {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .stats-section {
          flex-direction: column;
          gap: 10px;
        }

        .tense-checkboxes {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üáÆüáπ Coniugazioni</h1>
        <p>Practice Italian verb conjugations</p>
      </div>

      <div class="card">
        <div class="tabs">
          <button class="tab active" data-tab="practice">Practice</button>
          <button class="tab" data-tab="progress">Progress</button>
          <button class="tab" data-tab="info">Info</button>
        </div>

        <div class="tab-content active" id="practice">
          <div class="practice-section">
            <div class="stats-section">
              <div class="stat-item">
                <div class="stat-number" id="correctCount">0</div>
                <div class="stat-label">Correct</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Total</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="accuracyPercent">0%</div>
                <div class="stat-label">Accuracy</div>
              </div>
            </div>

            <div class="settings-panel">
              <div class="settings-row">
                <div class="settings-group">
                  <label>Verb Difficulty Range:</label>
                  <div class="level-range">
                    <select id="verbLevelStart" onchange="updateSettings()">
                      <option value="beginner">Beginner</option>
                      <option value="intermediate">Intermediate</option>
                      <option value="advanced">Advanced</option>
                    </select>
                    <span>to</span>
                    <select id="verbLevelEnd" onchange="updateSettings()">
                      <option value="beginner">Beginner</option>
                      <option value="intermediate">Intermediate</option>
                      <option value="advanced" selected>Advanced</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="tense-selection">
                <label
                  style="
                    font-weight: 600;
                    color: #495057;
                    margin-bottom: 10px;
                    display: block;
                  "
                  >Select Tenses to Practice:</label
                >
                <div class="tense-checkboxes" id="tenseCheckboxes">
                  <!-- Checkboxes will be populated by JavaScript -->
                </div>
                <div class="select-buttons">
                  <button class="btn-small" onclick="selectAllTenses()">
                    Select All
                  </button>
                  <button class="btn-small" onclick="selectBasicTenses()">
                    Basic Only
                  </button>
                  <button class="btn-small" onclick="clearAllTenses()">
                    Clear All
                  </button>
                </div>
              </div>
            </div>

            <div class="conjugation-display" id="conjugationDisplay">
              <div class="empty-state">
                Click "New Verb" to start practicing!
              </div>
            </div>

            <div class="controls">
              <button class="btn" onclick="getNewVerb()">New Verb</button>
              <button class="btn btn-secondary" onclick="resetStats()">
                Reset Stats
              </button>
            </div>
          </div>
        </div>

        <div class="tab-content" id="progress">
          <div style="text-align: center">
            <h3 style="margin-bottom: 20px">Practice Progress</h3>

            <div class="stats-section">
              <div class="stat-item">
                <div class="stat-number" id="sessionLength">0</div>
                <div class="stat-label">This Session</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="currentStreak">0</div>
                <div class="stat-label">Current Streak</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="bestStreak">0</div>
                <div class="stat-label">Best Streak</div>
              </div>
            </div>

            <div style="margin-top: 30px">
              <h4 style="margin-bottom: 15px">Recent Mistakes</h4>
              <div
                id="recentMistakes"
                style="text-align: left; max-height: 200px; overflow-y: auto"
              >
                <p
                  style="color: #6c757d; font-style: italic; text-align: center"
                >
                  No mistakes yet - great job!
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="info">
          <div class="info-section">
            <h3>Italian Conjugation Practice - Instructions</h3>

            <h4>How to Use:</h4>
            <p>
              <strong>Practice Tab:</strong> Set your difficulty range and
              select which tenses you want to practice. Click "New Verb" to get
              a random verb and conjugation challenge. Type your answer and
              press Enter to submit. After checking your answer, click "New
              Verb" again to continue.
            </p>

            <h4>Features:</h4>
            <ul>
              <li>
                üîä Click the speaker icon to hear pronunciation of the verb
              </li>
              <li>üìñ Click the book icon to view full conjugation tables</li>
              <li>
                üí° Regularity hints show if a verb follows regular patterns
              </li>
              <li>üìä Track your accuracy and progress over time</li>
              <li>üéØ Choose specific tenses and difficulty levels</li>
              <li>üéöÔ∏è Use difficulty ranges from beginner to advanced</li>
            </ul>

            <h4>Difficulty Levels:</h4>
            <p>
              <strong>Beginner:</strong> Most common Italian verbs<br />
              <strong>Intermediate:</strong> Common and some irregular verbs<br />
              <strong>Advanced:</strong> Complex and irregular verbs
            </p>

            <h4>Available Tenses:</h4>
            <p>
              Choose from present, imperfect, past, future, conditional,
              subjunctive, and imperative forms. Use "Basic Only" for essential
              tenses or "Select All" for comprehensive practice.
            </p>

            <h4>Tips:</h4>
            <ul>
              <li>Start with Basic tenses and Beginner-Intermediate range</li>
              <li>
                The app won't auto-advance - you control when to get a new verb
              </li>
              <li>
                Use the pronunciation feature to improve your spoken Italian
              </li>
              <li>
                Regular practice is more effective than long study sessions
              </li>
            </ul>

            <p style="margin-top: 20px; font-style: italic; color: #6c757d">
              Buona pratica! (Good practice!)
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Verb conjugation database - same as before
      const verbDatabase = {
        essere: {
          translation: "to be",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "sono",
              tu: "sei",
              lui: "√®",
              noi: "siamo",
              voi: "siete",
              loro: "sono",
            },
            imperfetto: {
              io: "ero",
              tu: "eri",
              lui: "era",
              noi: "eravamo",
              voi: "eravate",
              loro: "erano",
            },
            passato_prossimo: {
              io: "sono stato/a",
              tu: "sei stato/a",
              lui: "√® stato/a",
              noi: "siamo stati/e",
              voi: "siete stati/e",
              loro: "sono stati/e",
            },
            futuro_semplice: {
              io: "sar√≤",
              tu: "sarai",
              lui: "sar√†",
              noi: "saremo",
              voi: "sarete",
              loro: "saranno",
            },
            condizionale_presente: {
              io: "sarei",
              tu: "saresti",
              lui: "sarebbe",
              noi: "saremmo",
              voi: "sareste",
              loro: "sarebbero",
            },
            condizionale_passato: {
              io: "sarei stato/a",
              tu: "saresti stato/a",
              lui: "sarebbe stato/a",
              noi: "saremmo stati/e",
              voi: "sareste stati/e",
              loro: "sarebbero stati/e",
            },
            congiuntivo_presente: {
              io: "sia",
              tu: "sia",
              lui: "sia",
              noi: "siamo",
              voi: "siate",
              loro: "siano",
            },
            congiuntivo_passato: {
              io: "sia stato/a",
              tu: "sia stato/a",
              lui: "sia stato/a",
              noi: "siamo stati/e",
              voi: "siate stati/e",
              loro: "siano stati/e",
            },
            congiuntivo_imperfetto: {
              io: "fossi",
              tu: "fossi",
              lui: "fosse",
              noi: "fossimo",
              voi: "foste",
              loro: "fossero",
            },
            imperativo_presente: {
              tu: "sii",
              lui: "sia",
              noi: "siamo",
              voi: "siate",
              loro: "siano",
            },
          },
        },
        avere: {
          translation: "to have",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "ho",
              tu: "hai",
              lui: "ha",
              noi: "abbiamo",
              voi: "avete",
              loro: "hanno",
            },
            imperfetto: {
              io: "avevo",
              tu: "avevi",
              lui: "aveva",
              noi: "avevamo",
              voi: "avevate",
              loro: "avevano",
            },
            passato_prossimo: {
              io: "ho avuto",
              tu: "hai avuto",
              lui: "ha avuto",
              noi: "abbiamo avuto",
              voi: "avete avuto",
              loro: "hanno avuto",
            },
            futuro_semplice: {
              io: "avr√≤",
              tu: "avrai",
              lui: "avr√†",
              noi: "avremo",
              voi: "avrete",
              loro: "avranno",
            },
            condizionale_presente: {
              io: "avrei",
              tu: "avresti",
              lui: "avrebbe",
              noi: "avremmo",
              voi: "avreste",
              loro: "avrebbero",
            },
            condizionale_passato: {
              io: "avrei avuto",
              tu: "avresti avuto",
              lui: "avrebbe avuto",
              noi: "avremmo avuto",
              voi: "avreste avuto",
              loro: "avrebbero avuto",
            },
            congiuntivo_presente: {
              io: "abbia",
              tu: "abbia",
              lui: "abbia",
              noi: "abbiamo",
              voi: "abbiate",
              loro: "abbiano",
            },
            congiuntivo_passato: {
              io: "abbia avuto",
              tu: "abbia avuto",
              lui: "abbia avuto",
              noi: "abbiamo avuto",
              voi: "abbiate avuto",
              loro: "abbiano avuto",
            },
            congiuntivo_imperfetto: {
              io: "avessi",
              tu: "avessi",
              lui: "avesse",
              noi: "avessimo",
              voi: "aveste",
              loro: "avessero",
            },
            imperativo_presente: {
              tu: "abbi",
              lui: "abbia",
              noi: "abbiamo",
              voi: "abbiate",
              loro: "abbiano",
            },
          },
        },
        fare: {
          translation: "to do/make",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "faccio",
              tu: "fai",
              lui: "fa",
              noi: "facciamo",
              voi: "fate",
              loro: "fanno",
            },
            imperfetto: {
              io: "facevo",
              tu: "facevi",
              lui: "faceva",
              noi: "facevamo",
              voi: "facevate",
              loro: "facevano",
            },
            passato_prossimo: {
              io: "ho fatto",
              tu: "hai fatto",
              lui: "ha fatto",
              noi: "abbiamo fatto",
              voi: "avete fatto",
              loro: "hanno fatto",
            },
            futuro_semplice: {
              io: "far√≤",
              tu: "farai",
              lui: "far√†",
              noi: "faremo",
              voi: "farete",
              loro: "faranno",
            },
            condizionale_presente: {
              io: "farei",
              tu: "faresti",
              lui: "farebbe",
              noi: "faremmo",
              voi: "fareste",
              loro: "farebbero",
            },
            condizionale_passato: {
              io: "avrei fatto",
              tu: "avresti fatto",
              lui: "avrebbe fatto",
              noi: "avremmo fatto",
              voi: "avreste fatto",
              loro: "avrebbero fatto",
            },
            congiuntivo_presente: {
              io: "faccia",
              tu: "faccia",
              lui: "faccia",
              noi: "facciamo",
              voi: "facciate",
              loro: "facciano",
            },
            congiuntivo_passato: {
              io: "abbia fatto",
              tu: "abbia fatto",
              lui: "abbia fatto",
              noi: "abbiamo fatto",
              voi: "abbiate fatto",
              loro: "abbiano fatto",
            },
            congiuntivo_imperfetto: {
              io: "facessi",
              tu: "facessi",
              lui: "facesse",
              noi: "facessimo",
              voi: "faceste",
              loro: "facessero",
            },
            imperativo_presente: {
              tu: "fa'",
              lui: "faccia",
              noi: "facciamo",
              voi: "fate",
              loro: "facciano",
            },
          },
        },
        dire: {
          translation: "to say/tell",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "dico",
              tu: "dici",
              lui: "dice",
              noi: "diciamo",
              voi: "dite",
              loro: "dicono",
            },
            imperfetto: {
              io: "dicevo",
              tu: "dicevi",
              lui: "diceva",
              noi: "dicevamo",
              voi: "dicevate",
              loro: "dicevano",
            },
            passato_prossimo: {
              io: "ho detto",
              tu: "hai detto",
              lui: "ha detto",
              noi: "abbiamo detto",
              voi: "avete detto",
              loro: "hanno detto",
            },
            futuro_semplice: {
              io: "dir√≤",
              tu: "dirai",
              lui: "dir√†",
              noi: "diremo",
              voi: "direte",
              loro: "diranno",
            },
            condizionale_presente: {
              io: "direi",
              tu: "diresti",
              lui: "direbbe",
              noi: "diremmo",
              voi: "direste",
              loro: "direbbero",
            },
            condizionale_passato: {
              io: "avrei detto",
              tu: "avresti detto",
              lui: "avrebbe detto",
              noi: "avremmo detto",
              voi: "avreste detto",
              loro: "avrebbero detto",
            },
            congiuntivo_presente: {
              io: "dica",
              tu: "dica",
              lui: "dica",
              noi: "diciamo",
              voi: "diciate",
              loro: "dicano",
            },
            congiuntivo_passato: {
              io: "abbia detto",
              tu: "abbia detto",
              lui: "abbia detto",
              noi: "abbiamo detto",
              voi: "abbiate detto",
              loro: "abbiano detto",
            },
            congiuntivo_imperfetto: {
              io: "dicessi",
              tu: "dicessi",
              lui: "dicesse",
              noi: "dicessimo",
              voi: "diceste",
              loro: "dicessero",
            },
            imperativo_presente: {
              tu: "di'",
              lui: "dica",
              noi: "diciamo",
              voi: "dite",
              loro: "dicano",
            },
          },
        },
        andare: {
          translation: "to go",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "vado",
              tu: "vai",
              lui: "va",
              noi: "andiamo",
              voi: "andate",
              loro: "vanno",
            },
            imperfetto: {
              io: "andavo",
              tu: "andavi",
              lui: "andava",
              noi: "andavamo",
              voi: "andavate",
              loro: "andavano",
            },
            passato_prossimo: {
              io: "sono andato/a",
              tu: "sei andato/a",
              lui: "√® andato/a",
              noi: "siamo andati/e",
              voi: "siete andati/e",
              loro: "sono andati/e",
            },
            futuro_semplice: {
              io: "andr√≤",
              tu: "andrai",
              lui: "andr√†",
              noi: "andremo",
              voi: "andrete",
              loro: "andranno",
            },
            condizionale_presente: {
              io: "andrei",
              tu: "andresti",
              lui: "andrebbe",
              noi: "andremmo",
              voi: "andreste",
              loro: "andrebbero",
            },
            condizionale_passato: {
              io: "sarei andato/a",
              tu: "saresti andato/a",
              lui: "sarebbe andato/a",
              noi: "saremmo andati/e",
              voi: "sareste andati/e",
              loro: "sarebbero andati/e",
            },
            congiuntivo_presente: {
              io: "vada",
              tu: "vada",
              lui: "vada",
              noi: "andiamo",
              voi: "andiate",
              loro: "vadano",
            },
            congiuntivo_passato: {
              io: "sia andato/a",
              tu: "sia andato/a",
              lui: "sia andato/a",
              noi: "siamo andati/e",
              voi: "siate andati/e",
              loro: "siano andati/e",
            },
            congiuntivo_imperfetto: {
              io: "andassi",
              tu: "andassi",
              lui: "andasse",
              noi: "andassimo",
              voi: "andaste",
              loro: "andassero",
            },
            imperativo_presente: {
              tu: "va'",
              lui: "vada",
              noi: "andiamo",
              voi: "andate",
              loro: "vadano",
            },
          },
        },
        stare: {
          translation: "to stay/be",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "sto",
              tu: "stai",
              lui: "sta",
              noi: "stiamo",
              voi: "state",
              loro: "stanno",
            },
            imperfetto: {
              io: "stavo",
              tu: "stavi",
              lui: "stava",
              noi: "stavamo",
              voi: "stavate",
              loro: "stavano",
            },
            passato_prossimo: {
              io: "sono stato/a",
              tu: "sei stato/a",
              lui: "√® stato/a",
              noi: "siamo stati/e",
              voi: "siete stati/e",
              loro: "sono stati/e",
            },
            futuro_semplice: {
              io: "star√≤",
              tu: "starai",
              lui: "star√†",
              noi: "staremo",
              voi: "starete",
              loro: "staranno",
            },
            condizionale_presente: {
              io: "starei",
              tu: "staresti",
              lui: "starebbe",
              noi: "staremmo",
              voi: "stareste",
              loro: "starebbero",
            },
            condizionale_passato: {
              io: "sarei stato/a",
              tu: "saresti stato/a",
              lui: "sarebbe stato/a",
              noi: "saremmo stati/e",
              voi: "sareste stati/e",
              loro: "sarebbero stati/e",
            },
            congiuntivo_presente: {
              io: "stia",
              tu: "stia",
              lui: "stia",
              noi: "stiamo",
              voi: "stiate",
              loro: "stiano",
            },
            congiuntivo_passato: {
              io: "sia stato/a",
              tu: "sia stato/a",
              lui: "sia stato/a",
              noi: "siamo stati/e",
              voi: "siate stati/e",
              loro: "siano stati/e",
            },
            congiuntivo_imperfetto: {
              io: "stessi",
              tu: "stessi",
              lui: "stesse",
              noi: "stessimo",
              voi: "steste",
              loro: "stessero",
            },
            imperativo_presente: {
              tu: "sta'",
              lui: "stia",
              noi: "stiamo",
              voi: "state",
              loro: "stiano",
            },
          },
        },
        venire: {
          translation: "to come",
          regular: false,
          difficulty: "intermediate",
          conjugations: {
            presente: {
              io: "vengo",
              tu: "vieni",
              lui: "viene",
              noi: "veniamo",
              voi: "venite",
              loro: "vengono",
            },
            imperfetto: {
              io: "venivo",
              tu: "venivi",
              lui: "veniva",
              noi: "venivamo",
              voi: "venivate",
              loro: "venivano",
            },
            passato_prossimo: {
              io: "sono venuto/a",
              tu: "sei venuto/a",
              lui: "√® venuto/a",
              noi: "siamo venuti/e",
              voi: "siete venuti/e",
              loro: "sono venuti/e",
            },
            futuro_semplice: {
              io: "verr√≤",
              tu: "verrai",
              lui: "verr√†",
              noi: "verremo",
              voi: "verrete",
              loro: "verranno",
            },
            condizionale_presente: {
              io: "verrei",
              tu: "verresti",
              lui: "verrebbe",
              noi: "verremmo",
              voi: "verreste",
              loro: "verrebbero",
            },
            condizionale_passato: {
              io: "sarei venuto/a",
              tu: "saresti venuto/a",
              lui: "sarebbe venuto/a",
              noi: "saremmo venuti/e",
              voi: "sareste venuti/e",
              loro: "sarebbero venuti/e",
            },
            congiuntivo_presente: {
              io: "venga",
              tu: "venga",
              lui: "venga",
              noi: "veniamo",
              voi: "veniate",
              loro: "vengano",
            },
            congiuntivo_passato: {
              io: "sia venuto/a",
              tu: "sia venuto/a",
              lui: "sia venuto/a",
              noi: "siamo venuti/e",
              voi: "siate venuti/e",
              loro: "siano venuti/e",
            },
            congiuntivo_imperfetto: {
              io: "venissi",
              tu: "venissi",
              lui: "venisse",
              noi: "venissimo",
              voi: "veniste",
              loro: "venissero",
            },
            imperativo_presente: {
              tu: "vieni",
              lui: "venga",
              noi: "veniamo",
              voi: "venite",
              loro: "vengano",
            },
          },
        },
        dovere: {
          translation: "to have to/must",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "devo",
              tu: "devi",
              lui: "deve",
              noi: "dobbiamo",
              voi: "dovete",
              loro: "devono",
            },
            imperfetto: {
              io: "dovevo",
              tu: "dovevi",
              lui: "doveva",
              noi: "dovevamo",
              voi: "dovevate",
              loro: "dovevano",
            },
            passato_prossimo: {
              io: "ho dovuto",
              tu: "hai dovuto",
              lui: "ha dovuto",
              noi: "abbiamo dovuto",
              voi: "avete dovuto",
              loro: "hanno dovuto",
            },
            futuro_semplice: {
              io: "dovr√≤",
              tu: "dovrai",
              lui: "dovr√†",
              noi: "dovremo",
              voi: "dovrete",
              loro: "dovranno",
            },
            condizionale_presente: {
              io: "dovrei",
              tu: "dovresti",
              lui: "dovrebbe",
              noi: "dovremmo",
              voi: "dovreste",
              loro: "dovrebbero",
            },
            condizionale_passato: {
              io: "avrei dovuto",
              tu: "avresti dovuto",
              lui: "avrebbe dovuto",
              noi: "avremmo dovuto",
              voi: "avreste dovuto",
              loro: "avrebbero dovuto",
            },
            congiuntivo_presente: {
              io: "debba",
              tu: "debba",
              lui: "debba",
              noi: "dobbiamo",
              voi: "dobbiate",
              loro: "debbano",
            },
            congiuntivo_passato: {
              io: "abbia dovuto",
              tu: "abbia dovuto",
              lui: "abbia dovuto",
              noi: "abbiamo dovuto",
              voi: "abbiate dovuto",
              loro: "abbiano dovuto",
            },
            congiuntivo_imperfetto: {
              io: "dovessi",
              tu: "dovessi",
              lui: "dovesse",
              noi: "dovessimo",
              voi: "doveste",
              loro: "dovessero",
            },
            imperativo_presente: {
              tu: "-",
              lui: "-",
              noi: "-",
              voi: "-",
              loro: "-",
            },
          },
        },
        potere: {
          translation: "to be able/can",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "posso",
              tu: "puoi",
              lui: "pu√≤",
              noi: "possiamo",
              voi: "potete",
              loro: "possono",
            },
            imperfetto: {
              io: "potevo",
              tu: "potevi",
              lui: "poteva",
              noi: "potevamo",
              voi: "potevate",
              loro: "potevano",
            },
            passato_prossimo: {
              io: "ho potuto",
              tu: "hai potuto",
              lui: "ha potuto",
              noi: "abbiamo potuto",
              voi: "avete potuto",
              loro: "hanno potuto",
            },
            futuro_semplice: {
              io: "potr√≤",
              tu: "potrai",
              lui: "potr√†",
              noi: "potremo",
              voi: "potrete",
              loro: "potranno",
            },
            condizionale_presente: {
              io: "potrei",
              tu: "potresti",
              lui: "potrebbe",
              noi: "potremmo",
              voi: "potreste",
              loro: "potrebbero",
            },
            condizionale_passato: {
              io: "avrei potuto",
              tu: "avresti potuto",
              lui: "avrebbe potuto",
              noi: "avremmo potuto",
              voi: "avreste potuto",
              loro: "avrebbero potuto",
            },
            congiuntivo_presente: {
              io: "possa",
              tu: "possa",
              lui: "possa",
              noi: "possiamo",
              voi: "possiate",
              loro: "possano",
            },
            congiuntivo_passato: {
              io: "abbia potuto",
              tu: "abbia potuto",
              lui: "abbia potuto",
              noi: "abbiamo potuto",
              voi: "abbiate potuto",
              loro: "abbiano potuto",
            },
            congiuntivo_imperfetto: {
              io: "potessi",
              tu: "potessi",
              lui: "potesse",
              noi: "potessimo",
              voi: "poteste",
              loro: "potessero",
            },
            imperativo_presente: {
              tu: "-",
              lui: "-",
              noi: "-",
              voi: "-",
              loro: "-",
            },
          },
        },
        volere: {
          translation: "to want",
          regular: false,
          difficulty: "beginner",
          conjugations: {
            presente: {
              io: "voglio",
              tu: "vuoi",
              lui: "vuole",
              noi: "vogliamo",
              voi: "volete",
              loro: "vogliono",
            },
            imperfetto: {
              io: "volevo",
              tu: "volevi",
              lui: "voleva",
              noi: "volevamo",
              voi: "volevate",
              loro: "volevano",
            },
            passato_prossimo: {
              io: "ho voluto",
              tu: "hai voluto",
              lui: "ha voluto",
              noi: "abbiamo voluto",
              voi: "avete voluto",
              loro: "hanno voluto",
            },
            futuro_semplice: {
              io: "vorr√≤",
              tu: "vorrai",
              lui: "vorr√†",
              noi: "vorremo",
              voi: "vorrete",
              loro: "vorranno",
            },
            condizionale_presente: {
              io: "vorrei",
              tu: "vorresti",
              lui: "vorrebbe",
              noi: "vorremmo",
              voi: "vorreste",
              loro: "vorrebbero",
            },
            condizionale_passato: {
              io: "avrei voluto",
              tu: "avresti voluto",
              lui: "avrebbe voluto",
              noi: "avremmo voluto",
              voi: "avreste voluto",
              loro: "avrebbero voluto",
            },
            congiuntivo_presente: {
              io: "voglia",
              tu: "voglia",
              lui: "voglia",
              noi: "vogliamo",
              voi: "vogliate",
              loro: "vogliano",
            },
            congiuntivo_passato: {
              io: "abbia voluto",
              tu: "abbia voluto",
              lui: "abbia voluto",
              noi: "abbiamo voluto",
              voi: "abbiate voluto",
              loro: "abbiano voluto",
            },
            congiuntivo_imperfetto: {
              io: "volessi",
              tu: "volessi",
              lui: "volesse",
              noi: "volessimo",
              voi: "voleste",
              loro: "volessero",
            },
            imperativo_presente: {
              tu: "-",
              lui: "-",
              noi: "-",
              voi: "-",
              loro: "-",
            },
          },
        },
      };

      // Available tenses with their display names
      const allTenses = {
        presente: "Presente",
        imperfetto: "Imperfetto",
        passato_prossimo: "Passato Prossimo",
        futuro_semplice: "Futuro Semplice",
        condizionale_presente: "Condizionale Presente",
        condizionale_passato: "Condizionale Passato",
        congiuntivo_presente: "Congiuntivo Presente",
        congiuntivo_passato: "Congiuntivo Passato",
        congiuntivo_imperfetto: "Congiuntivo Imperfetto",
        imperativo_presente: "Imperativo",
      };

      const basicTenses = [
        "presente",
        "passato_prossimo",
        "futuro_semplice",
        "imperativo_presente",
      ];

      // Person definitions in Italian
      const persons = {
        io: "prima persona singolare",
        tu: "seconda persona singolare",
        lui: "terza persona singolare",
        noi: "prima persona plurale",
        voi: "seconda persona plurale",
        loro: "terza persona plurale",
      };

      // Current practice state
      let currentVerb = null;
      let currentTense = null;
      let currentPerson = null;
      let currentAnswer = null;
      let attempts = 0;
      let maxAttempts = 3;

      // Statistics
      let stats = {
        correct: 0,
        total: 0,
        currentStreak: 0,
        bestStreak: 0,
        recentMistakes: [],
      };

      // Settings
      let settings = {
        verbLevelStart: "beginner",
        verbLevelEnd: "advanced",
        selectedTenses: [...basicTenses],
      };

      // Function to pronounce Italian words using ResponsiveVoice
      function pronounceWord(word) {
        if (typeof responsiveVoice !== "undefined") {
          responsiveVoice.speak(word, "Italian Male", {
            rate: 0.95,
            pitch: 1,
            volume: 1,
          });
        } else {
          console.log("ResponsiveVoice not loaded yet");
          alert(
            "Pronunciation feature is still loading. Please try again in a moment."
          );
        }
      }

      // Open Italian conjugation in new tab
      function openConjugation(verb) {
        const conjugationUrl = `https://conjugator.reverso.net/conjugation-italian-verb-${encodeURIComponent(
          verb
        )}.html`;
        window.open(conjugationUrl, "_blank");
      }

      // Normalize text for comparison (remove accents, case insensitive)
      function normalizeText(text) {
        return text
          .toLowerCase()
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "") // Remove accent marks
          .replace(/['']/g, "'") // Normalize apostrophes
          .trim();
      }

      // Get available verbs based on current difficulty range
      function getAvailableVerbs() {
        const levelOrder = ["beginner", "intermediate", "advanced"];
        const startIndex = levelOrder.indexOf(settings.verbLevelStart);
        const endIndex = levelOrder.indexOf(settings.verbLevelEnd);
        const targetLevels = levelOrder.slice(startIndex, endIndex + 1);

        return Object.keys(verbDatabase).filter((verb) =>
          targetLevels.includes(verbDatabase[verb].difficulty)
        );
      }

      // Get available tenses based on selected tenses
      function getAvailableTenses(verb) {
        const verbData = verbDatabase[verb];

        return settings.selectedTenses.filter((tense) => {
          const conjugation = verbData.conjugations[tense];
          if (!conjugation) return false;

          // Check if at least one person has a valid conjugation (not "-")
          return Object.values(conjugation).some(
            (form) => form && form !== "-"
          );
        });
      }

      // Initialize tense checkboxes
      function initializeTenseCheckboxes() {
        const container = document.getElementById("tenseCheckboxes");
        container.innerHTML = "";

        Object.entries(allTenses).forEach(([tenseKey, tenseName]) => {
          const checked = settings.selectedTenses.includes(tenseKey)
            ? "checked"
            : "";
          container.innerHTML += `
            <div class="tense-checkbox">
              <input type="checkbox" id="tense-${tenseKey}" value="${tenseKey}" ${checked} onchange="updateSelectedTenses()">
              <label for="tense-${tenseKey}">${tenseName}</label>
            </div>
          `;
        });
      }

      // Update selected tenses from checkboxes
      function updateSelectedTenses() {
        const checkboxes = document.querySelectorAll(
          '#tenseCheckboxes input[type="checkbox"]'
        );
        settings.selectedTenses = Array.from(checkboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.value);

        console.log("Selected tenses:", settings.selectedTenses);
      }

      // Select all tenses
      function selectAllTenses() {
        const checkboxes = document.querySelectorAll(
          '#tenseCheckboxes input[type="checkbox"]'
        );
        checkboxes.forEach((cb) => (cb.checked = true));
        updateSelectedTenses();
      }

      // Select only basic tenses
      function selectBasicTenses() {
        const checkboxes = document.querySelectorAll(
          '#tenseCheckboxes input[type="checkbox"]'
        );
        checkboxes.forEach((cb) => {
          cb.checked = basicTenses.includes(cb.value);
        });
        updateSelectedTenses();
      }

      // Clear all tenses
      function clearAllTenses() {
        const checkboxes = document.querySelectorAll(
          '#tenseCheckboxes input[type="checkbox"]'
        );
        checkboxes.forEach((cb) => (cb.checked = false));
        updateSelectedTenses();
      }

      // Get new random verb conjugation challenge
      function getNewVerb() {
        if (settings.selectedTenses.length === 0) {
          showFeedback("Please select at least one tense to practice", "error");
          return;
        }

        const availableVerbs = getAvailableVerbs();

        if (availableVerbs.length === 0) {
          showFeedback(
            "No verbs available for current difficulty range",
            "error"
          );
          return;
        }

        // Select random verb
        currentVerb =
          availableVerbs[Math.floor(Math.random() * availableVerbs.length)];

        // Get available tenses for this verb
        const availableTenses = getAvailableTenses(currentVerb);

        if (availableTenses.length === 0) {
          showFeedback("No selected tenses available for this verb", "error");
          return;
        }

        // Select random tense
        currentTense =
          availableTenses[Math.floor(Math.random() * availableTenses.length)];

        // Select random person
        const availablePersons = Object.keys(
          verbDatabase[currentVerb].conjugations[currentTense]
        );
        currentPerson =
          availablePersons[Math.floor(Math.random() * availablePersons.length)];

        // Get correct answer
        currentAnswer =
          verbDatabase[currentVerb].conjugations[currentTense][currentPerson];

        // Skip if answer is "-" (not applicable)
        if (currentAnswer === "-") {
          getNewVerb(); // Try again
          return;
        }

        // Reset attempts
        attempts = 0;

        // Display the challenge
        displayChallenge();

        // Clear previous feedback
        hideFeedback();

        console.log(
          `New challenge: ${currentVerb} - ${currentTense} - ${currentPerson} = ${currentAnswer}`
        );
      }

      // Display the current challenge
      function displayChallenge() {
        const display = document.getElementById("conjugationDisplay");
        const verbData = verbDatabase[currentVerb];

        display.innerHTML = `
    <div class="verb-prompt">
      ${currentVerb}
      <span class="speaker-icon" onclick="pronounceWord('${currentVerb}')" title="Pronounce verb">üîä</span>
      <span class="dict-icon" onclick="openConjugation('${currentVerb}')" title="View full conjugation">üìñ</span>
    </div>
    <div style="font-size: 1.1em; color: #6c757d; margin-bottom: 15px;">
      ${verbData.translation}
    </div>
    <div id="regularityHint" style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px; display: none;">
  ${verbData.regular ? "‚úì Regular verb" : "‚ö†Ô∏è Irregular verb"}
</div>
    <div class="conjugation-prompt">
      ${allTenses[currentTense]} - ${persons[currentPerson]}
    </div>
    <div class="answer-section">
      <input type="text" class="answer-input" id="answerInput" 
             placeholder="Type your answer..." onkeypress="handleKeyPress(event)">
    </div>
    <div class="controls" style="margin-top: 15px;">
  <button class="btn" onclick="checkAnswer()">Check Answer</button>
  <button class="btn btn-warning" onclick="showCorrectAnswer()">Show Answer</button>
  <button class="btn btn-secondary" onclick="toggleRegularityHint()">Show Hint</button>
</div>
  `;

        // Focus on input
        document.getElementById("answerInput").focus();
      }

      // Handle Enter key press
      function handleKeyPress(event) {
        if (event.key === "Enter") {
          checkAnswer();
        }
      }

      // Check the user's answer
      function checkAnswer() {
        const userAnswer = document.getElementById("answerInput").value.trim();

        if (!userAnswer) {
          showFeedback("Please enter an answer", "error");
          return;
        }

        attempts++;

        // Normalize both answers for comparison
        const normalizedUser = normalizeText(userAnswer);
        const normalizedCorrect = normalizeText(currentAnswer);

        if (normalizedUser === normalizedCorrect) {
          // Correct answer
          handleCorrectAnswer();
        } else {
          // Wrong answer
          handleWrongAnswer(userAnswer);
        }
      }

      // Handle correct answer
      function handleCorrectAnswer() {
        const input = document.getElementById("answerInput");
        input.className = "answer-input correct";
        input.disabled = true;

        // Update stats
        stats.correct++;
        stats.total++;
        stats.currentStreak++;

        if (stats.currentStreak > stats.bestStreak) {
          stats.bestStreak = stats.currentStreak;
        }

        updateStatsDisplay();

        showFeedback(`Correct! üéâ Click "New Verb" to continue.`, "success");
      }

      // Handle wrong answer
      function handleWrongAnswer(userAnswer) {
        const input = document.getElementById("answerInput");
        input.className = "answer-input incorrect";

        stats.total++;
        stats.currentStreak = 0;

        // Add to recent mistakes
        stats.recentMistakes.unshift({
          verb: currentVerb,
          tense: currentTense,
          person: currentPerson,
          userAnswer: userAnswer,
          correctAnswer: currentAnswer,
          timestamp: new Date(),
        });

        // Keep only last 10 mistakes
        if (stats.recentMistakes.length > 10) {
          stats.recentMistakes = stats.recentMistakes.slice(0, 10);
        }

        updateStatsDisplay();
        updateRecentMistakes();

        if (attempts < maxAttempts) {
          showFeedback(
            `Not quite right. Try again! (Attempt ${attempts}/${maxAttempts})`,
            "error"
          );

          // Reset input style after a moment and let them try again
          setTimeout(() => {
            input.className = "answer-input";
            input.value = "";
            input.focus();
          }, 1500);
        } else {
          showFeedback(
            `Incorrect. The answer is: <strong>${currentAnswer}</strong><br>Click "New Verb" to continue.`,
            "error"
          );
          input.disabled = true;
        }
      }

      // Show correct answer
      function showCorrectAnswer() {
        const input = document.getElementById("answerInput");
        input.value = currentAnswer;
        input.className = "answer-input";
        input.disabled = true;

        showFeedback(
          `The correct answer is: <strong>${currentAnswer}</strong><br>Click "New Verb" to continue.`,
          "info"
        );

        // This counts as getting it wrong for stats
        stats.total++;
        stats.currentStreak = 0;
        updateStatsDisplay();
      }

      // Toggle regularity hint visibility
      function toggleRegularityHint() {
        const hint = document.getElementById("regularityHint");
        const button = event.target;

        if (hint.style.display === "none") {
          hint.style.display = "block";
          button.textContent = "Hide Hint";
        } else {
          hint.style.display = "none";
          button.textContent = "Show Hint";
        }
      }

      // Show feedback message
      function showFeedback(message, type) {
        const feedback = document.querySelector(".feedback-section");
        if (!feedback) {
          // Create feedback section if it doesn't exist
          const feedbackDiv = document.createElement("div");
          feedbackDiv.className = "feedback-section";
          document
            .getElementById("conjugationDisplay")
            .appendChild(feedbackDiv);
        }

        const feedbackElement = document.querySelector(".feedback-section");
        feedbackElement.innerHTML = message;
        feedbackElement.className = `feedback-section ${type}`;
      }

      // Hide feedback
      function hideFeedback() {
        const feedback = document.querySelector(".feedback-section");
        if (feedback) {
          feedback.className = "feedback-section";
        }
      }

      // Update statistics display
      function updateStatsDisplay() {
        document.getElementById("correctCount").textContent = stats.correct;
        document.getElementById("totalCount").textContent = stats.total;

        const accuracy =
          stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
        document.getElementById("accuracyPercent").textContent = accuracy + "%";

        document.getElementById("sessionLength").textContent = stats.total;
        document.getElementById("currentStreak").textContent =
          stats.currentStreak;
        document.getElementById("bestStreak").textContent = stats.bestStreak;
      }

      // Update recent mistakes display
      function updateRecentMistakes() {
        const container = document.getElementById("recentMistakes");

        if (stats.recentMistakes.length === 0) {
          container.innerHTML =
            '<p style="color: #6c757d; font-style: italic; text-align: center;">No mistakes yet - great job!</p>';
          return;
        }

        const mistakesHtml = stats.recentMistakes
          .map(
            (mistake) => `
          <div style="background: #f8f9fa; padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 3px solid #dc3545;">
            <strong>${mistake.verb}</strong> (${allTenses[mistake.tense]} - ${
              persons[mistake.person]
            })<br>
            <span style="color: #dc3545;">Your answer: ${
              mistake.userAnswer
            }</span><br>
            <span style="color: #28a745;">Correct: ${
              mistake.correctAnswer
            }</span>
          </div>
        `
          )
          .join("");

        container.innerHTML = mistakesHtml;
      }

      // Reset statistics
      function resetStats() {
        stats = {
          correct: 0,
          total: 0,
          currentStreak: 0,
          bestStreak: 0,
          recentMistakes: [],
        };

        updateStatsDisplay();
        updateRecentMistakes();

        showFeedback("Statistics reset!", "info");
        setTimeout(hideFeedback, 2000);
      }

      // Update settings
      function updateSettings() {
        const levelStart = document.getElementById("verbLevelStart").value;
        const levelEnd = document.getElementById("verbLevelEnd").value;

        // Ensure end level is not before start level
        const levelOrder = ["beginner", "intermediate", "advanced"];
        const startIndex = levelOrder.indexOf(levelStart);
        const endIndex = levelOrder.indexOf(levelEnd);

        if (endIndex < startIndex) {
          document.getElementById("verbLevelEnd").value = levelStart;
          settings.verbLevelEnd = levelStart;
        } else {
          settings.verbLevelEnd = levelEnd;
        }

        settings.verbLevelStart = levelStart;

        console.log("Settings updated:", settings);
      }

      // Tab switching functionality
      function setupTabSwitching() {
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".tab")
              .forEach((t) => t.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((content) => content.classList.remove("active"));

            tab.classList.add("active");
            document.getElementById(tab.dataset.tab).classList.add("active");
          });
        });
      }

      // Initialize the app
      function initializeApp() {
        setupTabSwitching();
        initializeTenseCheckboxes();
        updateSettings();
        updateStatsDisplay();
        updateRecentMistakes();

        console.log("Italian Conjugation Practice app initialized");
        console.log("Available verbs:", Object.keys(verbDatabase).length);
      }

      // Wait for DOM to be ready before initializing
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeApp);
      } else {
        initializeApp();
      }

      // Register service worker for PWA functionality
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register(
            "data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbChzZWxmLnNraXBXYWl0aW5nKCkpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7CiAgZXZlbnQud2FpdFVudGlsKHNlbGYuY2xpZW50cy5jbGFpbSgpKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZXZlbnQgPT4gewogIGV2ZW50LnJlc3BvbmRXaXRoKGZldGNoKGV2ZW50LnJlcXVlc3QpKTsKfSk7"
          )
          .then(() => console.log("Service Worker registered"))
          .catch((err) => console.log("Service Worker registration failed"));
      }
    </script>
  </body>
</html>
